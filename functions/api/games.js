// Mock database of VR games
export const mockGames = [
  {
    id: 1,
    title: 'Space Explorer VR',
    description: 'Explore the vastness of space in this immersive VR experience. Discover planets, stars, and cosmic phenomena as you navigate through our solar system and beyond.',
    category: 'adventure',
    imageUrl: 'https://images.unsplash.com/photo-1581822261290-991b38693d1b?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1581822261290-991b38693d1b?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/RqJJ9oU9/',
    featured: true,
    rating: 4.8,
    playCount: 1250,
    createdAt: '2023-01-15T12:00:00Z'
  },
  {
    id: 2,
    title: 'Zombie Survival VR',
    description: 'Survive the zombie apocalypse in this heart-pounding VR game. Scavenge for supplies, craft weapons, and defend yourself against hordes of the undead.',
    category: 'action',
    imageUrl: 'https://images.unsplash.com/photo-1509515837298-2c67a3933321?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1509515837298-2c67a3933321?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/44MX6JkR/',
    featured: false,
    rating: 4.5,
    playCount: 980,
    createdAt: '2023-02-20T14:30:00Z'
  },
  {
    id: 3,
    title: 'Ocean Deep VR',
    description: 'Dive into the depths of the ocean and discover marine life in VR. Swim alongside dolphins, whales, and exotic fish in this relaxing underwater adventure.',
    category: 'simulation',
    imageUrl: 'https://images.unsplash.com/photo-1551244072-5d12893278ab?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1551244072-5d12893278ab?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/ZV4PW6wr/',
    featured: true,
    rating: 4.7,
    playCount: 1050,
    createdAt: '2023-03-10T09:15:00Z'
  },
  {
    id: 4,
    title: 'VR Puzzle Master',
    description: 'Challenge your mind with intricate 3D puzzles in virtual reality. Manipulate objects, solve riddles, and unlock new levels in this brain-teasing adventure.',
    category: 'puzzle',
    imageUrl: 'https://images.unsplash.com/photo-1553481187-be93c21490a9?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1553481187-be93c21490a9?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/JtL2iqIH/',
    featured: false,
    rating: 4.6,
    playCount: 850,
    createdAt: '2023-04-05T16:45:00Z'
  },
  {
    id: 5,
    title: 'Mountain Climb VR',
    description: 'Experience the thrill of mountain climbing without the risk. Scale towering peaks, navigate treacherous paths, and enjoy breathtaking views in this VR adventure.',
    category: 'adventure',
    imageUrl: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/2zwQpVJt/',
    featured: false,
    rating: 4.4,
    playCount: 720,
    createdAt: '2023-05-12T11:20:00Z'
  },
  {
    id: 6,
    title: 'VR Racing Championship',
    description: 'Feel the speed in this immersive VR racing game. Compete against AI or other players, customize your vehicles, and race on tracks around the world.',
    category: 'racing',
    imageUrl: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/MflWvdTW/',
    featured: true,
    rating: 4.9,
    playCount: 1500,
    createdAt: '2023-06-18T08:30:00Z'
  },
  {
    id: 7,
    title: 'Archery Master VR',
    description: 'Test your precision and skill in this virtual reality archery game. Hit targets, complete challenges, and become the ultimate archer.',
    category: 'sports',
    imageUrl: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/JERg21J8/',
    featured: false,
    rating: 4.3,
    playCount: 650,
    createdAt: '2023-07-22T14:15:00Z'
  },
  {
    id: 8,
    title: 'Cosmic Shooter VR',
    description: 'Defend the galaxy from alien invaders in this action-packed VR shooter. Upgrade your weapons, improve your ship, and save humanity from extinction.',
    category: 'shooter',
    imageUrl: 'https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    thumbnailUrl: 'https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80',
    gameUrl: 'https://playcanv.as/p/SA7hVBLt/',
    featured: false,
    rating: 4.5,
    playCount: 920,
    createdAt: '2023-08-30T19:45:00Z'
  }
];

export async function onRequest(context) {
  // Set CORS headers
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'GET, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Content-Type': 'application/json'
  };

  // Handle OPTIONS request for CORS preflight
  if (context.request.method === 'OPTIONS') {
    return new Response(null, { headers });
  }

  // Only allow GET requests
  if (context.request.method !== 'GET') {
    return new Response(JSON.stringify({ error: 'Method not allowed' }), {
      status: 405,
      headers
    });
  }

  try {
    // Parse query parameters
    const url = new URL(context.request.url);
    const category = url.searchParams.get('category') || 'all';
    const search = url.searchParams.get('search') || '';
    const page = parseInt(url.searchParams.get('page') || '1', 10);
    const limit = parseInt(url.searchParams.get('limit') || '12', 10);

    // Filter games
    let filteredGames = [...mockGames];
    
    // Apply category filter
    if (category !== 'all') {
      filteredGames = filteredGames.filter(game => game.category === category);
    }
    
    // Apply search filter
    if (search) {
      const searchLower = search.toLowerCase();
      filteredGames = filteredGames.filter(game => 
        game.title.toLowerCase().includes(searchLower) || 
        game.description.toLowerCase().includes(searchLower)
      );
    }
    
    // Calculate total pages
    const totalGames = filteredGames.length;
    const totalPages = Math.ceil(totalGames / limit) || 1;
    
    // Apply pagination
    const startIndex = (page - 1) * limit;
    const endIndex = startIndex + limit;
    const paginatedGames = filteredGames.slice(startIndex, endIndex);
    
    // Return response
    return new Response(JSON.stringify({
      games: paginatedGames,
      totalGames,
      totalPages,
      currentPage: page
    }), { headers });
    
  } catch (error) {
    console.error('Error processing request:', error);
    
    return new Response(JSON.stringify({ 
      error: 'Internal server error',
      message: error.message 
    }), {
      status: 500,
      headers
    });
  }
} 